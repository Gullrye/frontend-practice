<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      #canvas {
        background: #000;
      }
      #eraser {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: grey;
        border: none;
        padding: 5px;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <button id="eraser">橡皮擦</button>
    <script>
      const canvas = document.getElementById('canvas')
      setCanvasSize()
      window.onresize = () => {
        setCanvasSize()
      }
      
      const ctx = canvas.getContext('2d')
      let using = false  // 鼠标是否 mousedown
      let lastPoint = { x: undefined, y: undefined }
      let eraserEnable = false
      let eraser = document.getElementById('eraser')
      
      eraser.onclick = (e) => {
        eraserEnable = !eraserEnable
        if (eraserEnable) {
          e.target.style.backgroundColor = '#fff'
        } else {
          e.target.style.backgroundColor = 'grey'
        }
      }
      

      canvas.onmousedown = (e) => {
        let x = e.clientX
        let y = e.clientY
        if (eraserEnable) {
          using = true
          ctx.clearRect(x-10, y-10, 20, 20)
        } else {
          using = true
          drawCircle(x, y, 2.5)
          lastPoint = { x: x, y: y }
        }
      }

      canvas.onmousemove = (e) => {
        let x = e.clientX
        let y = e.clientY
        if (eraserEnable) {
          if (using) {
            ctx.clearRect(x-10, y-10, 20, 20)
          }
        } else {
          if (using) {
            let newPoint = { x: x, y: y }
            drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y)
            lastPoint = newPoint
          }
        }
      }

      canvas.onmouseup = () => {
        using = false
      }

      function setCanvasSize() {
        let pageWidth = document.documentElement.clientWidth
        let pageHeight = document.documentElement.clientHeight
        canvas.width = pageWidth
        canvas.height = pageHeight
      }

      function drawCircle(x, y, radius) {
        ctx.beginPath()
        ctx.fillStyle = '#fff'
        ctx.arc(x, y, radius, 0, Math.PI * 2)
        ctx.fill()
      }

      function drawLine(x1, y1, x2, y2) {
        ctx.beginPath()
        ctx.lineWidth = 5
        ctx.strokeStyle = '#fff'
        ctx.moveTo(x1, y1)
        ctx.lineTo(x2, y2)
        ctx.stroke()
        ctx.closePath()
      }
    </script>
  </body>
</html>
